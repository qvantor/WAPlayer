!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("WAPlayer",[],e):"object"==typeof exports?exports.WAPlayer=e():t.WAPlayer=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),r=function(){function t(e){var i=this;n(this,t),e=e||{},this.ctx=new AudioContext,this.gain=this.ctx.createGain(),this.analyser=this.ctx.createAnalyser(),this.panner=this.ctx.createStereoPanner(),this.paused=!0,this.time=0,e.filters&&(this.filters=[],e.filters.forEach(function(t){var e=i.ctx.createBiquadFilter();e.type=t.type||"peaking",e.frequency.value=t.frequency||350,e.gain.value=t.gain||0,e.Q.value=t.Q||0,i.filters.push(e)})),this.events={play:[],pause:[],timeChange:[],volume:[],seek:[],load:[],loaded:[],endFile:[]}}return a(t,[{key:"play",value:function(){var t=this;this.paused&&!this.loading&&(this._createSource(),this.paused=!1,this.time>0?this.source.start(0,this.time):this.source.start(0),this._interval=setInterval(function(){t._last&&(t.time=t.time+(new Date-t._last)/1e3),t._last=new Date,t.time>=t.duration&&(t.stop(),t._emit("endFile")),t._emit("timeChange",t.time)},50),this._emit("play"))}},{key:"pause",value:function(){this.loading||this.paused||(this.paused=!0,this.source.stop(0),this._last=null,clearInterval(this._interval),this._emit("pause"))}},{key:"stop",value:function(){this.loading||this.paused||(this.paused=!0,this.time=0,this._last=null,clearInterval(this._interval),this.source.stop(0),this._emit("pause"))}},{key:"toggle",value:function(){this.paused?this.play():this.pause()}},{key:"volume",value:function(t){this.gain.gain.value=t,this._emit("volume",t)}},{key:"seek",value:function(t){this.loading||t<0||(this.time=t,this.paused||(this.source.stop(0),this._createSource(),this.source.start(0,this.time)),this._emit("timeChange",t),this._emit("seek",t))}},{key:"load",value:function(t){var e=this;return new Promise(function(i,n){return e.loading?n(!1):(e.source&&(clearInterval(e._interval),e.source.stop(0)),e.loading=!0,void e._loadSoundFile(t,e.ctx).then(function(t){e.buffer=t,e.duration=t.duration.toFixed(0),e.time=0,e.paused=!0,e.loading=!1,e._createSource(),e._emit("loaded"),i(e)})["catch"](n))})}},{key:"destroy",value:function(){clearInterval(this._interval),this.ctx.close()}},{key:"on",value:function(t,e){return this.events[t]&&"function"==typeof e&&this.events[t].push(e),this}},{key:"_emit",value:function(t,e){var i=this;this.events[t].length>0&&this.events[t].forEach(function(t){t.call(i,e)})}},{key:"_createSource",value:function(){if(this.source=this.ctx.createBufferSource(),this.source.connect(this.panner),this.panner.connect(this.gain),this.filters&&this.filters.length>0){for(var t=0;t<this.filters.length;t++)0===t?this.gain.connect(this.filters[t]):this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.analyser),this.filters[this.filters.length-1].connect(this.ctx.destination)}else this.gain.connect(this.analyser),this.gain.connect(this.ctx.destination);this.source.buffer=this.buffer}},{key:"_loadSoundFile",value:function(t,e){var i=this;return new Promise(function(n,a){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onprogress=function(t){i._emit("load",t)},s.onload=function(t){e.decodeAudioData(this.response,function(t){n(t)},function(t){a("Error decoding file",t)})},s.onerror=function(t){a(t)},s.send()})}}]),t}();e.Player=r,e.Visualization=s.Visualization},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Visualization=void 0;var n=i(2),a=i(3);e.Visualization={"default":n.Visualization,circle:a.Visualization}},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.Visualization=function(){function t(e,n){var a=this;i(this,t),this.analyser=e,this.analyser.fftSize=n.specification||2048,this.parent=document.querySelector(n.selector),this.canvas=document.createElement("canvas"),this.canvas.width=this.parent.clientWidth,this.canvas.height=255,this.parent.appendChild(this.canvas),this.canvasCtx=this.canvas.getContext("2d"),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.destroyed=!1,this.grd=this.canvasCtx.createLinearGradient(0,255,0,0),n.gardient.forEach(function(t){a.grd.addColorStop(t[0],t[1])}),this.hzPerNumber=this.analyser.context.sampleRate/this.analyser.fftSize,this.startHz=Math.round(50/this.hzPerNumber),this.endHz=Math.round(2e4/this.hzPerNumber),this.animation()}return n(t,[{key:"animation",value:function(){this.canvas.width=this.parent.clientWidth;var t=this.canvas.clientWidth/this.dataArray.length*1.4;this.analyser.getByteFrequencyData(this.dataArray),this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasCtx.beginPath(),this.canvasCtx.moveTo(0,255);for(var e=this.startHz;e<this.endHz;e++)this.canvasCtx.lineTo(e*t,255-this.dataArray[e]);this.canvasCtx.lineTo(this.dataArray.length*t,255),this.canvasCtx.fillStyle=this.grd,this.canvasCtx.fill(),this.canvasCtx.lineWidth=.001,this.canvasCtx.stroke(),this.destroyed||requestAnimationFrame(this.animation.bind(this))}},{key:"destroy",value:function(){this.destroyed=!0,this.parent.removeChild(this.canvas)}}]),t}()},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.Visualization=function(){function t(e,n){i(this,t),this.config=n,this.parent=document.querySelector(n.selector),this.canvas=document.createElement("canvas"),this.canvasCtx=this.canvas.getContext("2d"),this.canvas.width=this.parent.clientWidth,this.canvas.height=255,this.parent.appendChild(this.canvas),this.analyser=e,this.analyser.fftSize=32,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.destroyed=!1,this.animation()}return n(t,[{key:"animation",value:function(){this.analyser.getByteFrequencyData(this.dataArray),this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.dataArray.length;t++)this.canvasCtx.beginPath(),this.canvasCtx.arc(this.canvas.width/2,127.5,this.dataArray[t]/2,0,2*Math.PI,!1),this.canvasCtx.fillStyle=this.config.color||"rgba(52, 152, 219,0.1)",this.canvasCtx.fill(),this.canvasCtx.lineWidth=.001,this.canvasCtx.stroke();this.destroyed||requestAnimationFrame(this.animation.bind(this))}},{key:"destroy",value:function(){this.destroyed=!0,this.parent.removeChild(this.canvas)}}]),t}()}])});
//# sourceMappingURL=WAPlayer.min.js.map