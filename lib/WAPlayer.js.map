{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2ab4656d16d825ace2a5","webpack:///./src/index.js","webpack:///./src/visualization/index.js","webpack:///./src/visualization/default.js"],"names":["Player","ctx","AudioContext","gain","createGain","analyser","createAnalyser","paused","time","events","play","pause","timeChange","seek","load","loaded","endFile","loading","_createSource","source","start","_interval","setInterval","_last","Date","duration","stop","_emit","clearInterval","vol","value","src","Promise","resolve","reject","_loadSoundFile","then","data","buffer","toFixed","catch","event","cb","push","length","forEach","fn","call","createBufferSource","connect","destination","url","context","xhr","XMLHttpRequest","open","responseType","onprogress","e","onload","decodeAudioData","response","decodedArrayBuffer","onerror","send","exports","Visualization","default","config","fftSize","specification","parent","document","querySelector","selector","canvas","createElement","width","clientWidth","height","appendChild","canvasCtx","getContext","dataArray","Uint8Array","frequencyBinCount","grd","createLinearGradient","gardient","item","addColorStop","hzPerNumber","sampleRate","startHz","Math","round","endHz","animation","getByteFrequencyData","clearRect","beginPath","moveTo","i","lineTo","fillStyle","fill","lineWidth","stroke","requestAnimationFrame","bind"],"mappings":"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","file":"WAPlayer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"WAPlayer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WAPlayer\"] = factory();\n\telse\n\t\troot[\"WAPlayer\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 2ab4656d16d825ace2a5\n **/","import {Visualization} from './visualization/';\n\nclass Player {\n    constructor() {\n        this.ctx = new AudioContext();\n        this.gain = this.ctx.createGain();\n        this.analyser = this.ctx.createAnalyser();\n        this.paused = true;\n        this.time = 0;\n\n        this.events = {\n            play: [],\n            pause: [],\n            timeChange: [],\n            seek: [],\n            load: [],\n            loaded: [],\n            endFile: []\n        };\n    }\n\n    play() {\n        if (!this.paused || this.loading) return;\n\n        this._createSource();\n\n        this.paused = false;\n\n        if (this.time > 0) {\n            this.source.start(0, this.time);\n        } else {\n            this.source.start(0);\n        }\n\n        this._interval = setInterval(() => {\n            if (this._last) {\n                this.time = this.time + ((new Date() - this._last) / 1000);\n            }\n            this._last = new Date();\n            if (this.time >= this.duration) {\n                this.stop();\n                this._emit('endFile');\n            }\n            this._emit('timeChange', this.time);\n        }, 50);\n\n        this._emit('play');\n    }\n\n    pause() {\n        if (this.loading || this.paused) return;\n\n        this.paused = true;\n\n        this.source.stop(0);\n        this._last = null;\n        clearInterval(this._interval);\n        this._emit('pause');\n    }\n\n    stop() {\n        if (this.loading || this.paused) return;\n        this.paused = true;\n        this.time = 0;\n        this._last = null;\n        clearInterval(this._interval);\n        this.source.stop(0);\n        this._emit('pause');\n    }\n\n    toggle() {\n        this.paused ? this.play() : this.pause();\n    }\n\n    volume(vol) {\n        this.gain.gain.value = vol;\n    }\n\n    seek(time) {\n        if (this.loading) return;\n        if (time < 0) return;\n\n        this.time = time;\n\n        if (!this.paused) {\n            this.source.stop(0);\n            this._createSource();\n            this.source.start(0, this.time);\n        }\n        this._emit('timeChange', time);\n        this._emit('seek', time);\n    }\n\n    load(src) {\n        // @todo find way to cancel last one and make new one\n        return new Promise((resolve, reject) => {\n            if (this.loading) return reject(false);\n            if (this.source) {\n                clearInterval(this._interval);\n                this.source.stop(0);\n            }\n            this.loading = true;\n\n            this._loadSoundFile(src, this.ctx).then((data) => {\n                this.buffer = data;\n                this.duration = data.duration.toFixed(0);\n                this.time = 0;\n                this.paused = true;\n                this.loading = false;\n                this._createSource();\n                this._emit('loaded');\n                resolve(this);\n            }).catch(reject);\n        });\n    }\n\n    on(event, cb) {\n        if (this.events[event] && typeof cb === 'function') {\n            this.events[event].push(cb);\n        }\n        return this;\n    }\n\n    _emit(event, data) {\n        if (this.events[event].length > 0) {\n            this.events[event].forEach((fn) => {\n                fn.call(this, data);\n            });\n        }\n    }\n\n    _createSource() {\n        this.source = this.ctx.createBufferSource();\n        this.source.connect(this.gain);\n\n        this.source.connect(this.analyser);\n        this.gain.connect(this.ctx.destination);\n\n        this.source.buffer = this.buffer;\n    }\n\n    _loadSoundFile(url, context) {\n        return new Promise((resolve, reject) => {\n            let xhr = new XMLHttpRequest();\n\n            xhr.open('GET', url, true);\n            xhr.responseType = 'arraybuffer';\n            xhr.onprogress = (e) => {\n                this._emit('load', e);\n            };\n            xhr.onload = function (e) {\n                context.decodeAudioData(this.response,\n                    function (decodedArrayBuffer) {\n                        resolve(decodedArrayBuffer);\n                    }, function (e) {\n                        reject('Error decoding file', e);\n                    });\n            };\n            xhr.onerror = function (e) {\n                reject(e);\n            };\n            xhr.send();\n        });\n    }\n}\n\nexports.Player = Player;\nexports.Visualization = Visualization;\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/index.js\n **/","import {Visualization as _default} from './default';\n\nexport let Visualization = {\n    default: _default\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/visualization/index.js\n **/","export class Visualization {\n    constructor(analyser, config) {\n        this.analyser = analyser;\n        this.analyser.fftSize = config.specification || 2048;\n        this.parent = document.querySelector(config.selector);\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.parent.clientWidth;\n        this.canvas.height = 255;\n        this.parent.appendChild(this.canvas);\n        this.canvasCtx = this.canvas.getContext('2d');\n        this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n\n        this.grd = this.canvasCtx.createLinearGradient(0, 255, 0, 0);\n        config.gardient.forEach((item) => {\n            this.grd.addColorStop(item[0], item[1]);\n        });\n\n        this.hzPerNumber = this.analyser.context.sampleRate / this.analyser.fftSize;\n        this.startHz = Math.round(50 / this.hzPerNumber);\n        this.endHz = Math.round(20000 / this.hzPerNumber);\n        this.animation();\n    }\n\n    animation() {\n        this.canvas.width = this.parent.clientWidth;\n\n        let width = (this.canvas.clientWidth / this.dataArray.length) * 1.4;\n\n        this.analyser.getByteFrequencyData(this.dataArray);\n        this.canvasCtx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.canvasCtx.beginPath();\n        this.canvasCtx.moveTo(0, 255);\n\n        for (let i = this.startHz; i < this.endHz; i++) {\n            this.canvasCtx.lineTo(i * width, 255 - this.dataArray[i]);\n        }\n\n        this.canvasCtx.lineTo(this.dataArray.length * width, 255);\n\n        this.canvasCtx.fillStyle = this.grd;\n        this.canvasCtx.fill();\n        this.canvasCtx.lineWidth = 0.001;\n        this.canvasCtx.stroke();\n\n        requestAnimationFrame(this.animation.bind(this));\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/visualization/default.js\n **/"],"sourceRoot":""}